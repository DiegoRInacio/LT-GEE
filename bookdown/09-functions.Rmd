# Shortcut Functions

We have created a LandTrendr JavaScript module that contains several shortcut functions to run LandTrendr and deal with the outputs. To access these functions, you must visits this URL to add the eMapR public GEE repository 

We have developed a LandTrendr JavaScript module that contains several shortcut functions to build LandTrendr input collections, run LandTrendr, and deal with the outputs. The module be accessed from our public GEE repository. To include them in your applications, you must first visit this URL (https://code.earthengine.google.com/?accept_repo=users/emaprlab/public). It will add the users/emaprlab/public repository to your GEE account. Once added, it can be found within the Reader permission group of your GEE scripts library. You'll find the LandTrendr module at *Modules/LandTrendr.js*.

To use the shortcut functions, you must import the *LandTrendr.js* module into your script using the following line - place it at the top of the script. 

```
var ltgee = require('users/emaprlab/public:Modules/LandTrendr.js');
```

## Functions

+ **buildSRcollection**: Builds an annual cloud and cloud shadow masked medoid composite of Landsat surface reflectance TM-equivalent bands 1,2,3,4,5,7. This collection can be useful outside of use by LandTrendr, but is also the base for creating the input collection for LandTrendr
+ **buildLTcollection**: Builds a collection as input to LandTrendr. It will prepare a collection where the first band is the band to base spectral-temporal segmentation and the subsequent bands will be fitted to segmentation structure of the segmentation band 
+ **runLT**: Run LandTrendr given a set of parameters. A wrapper around *buildSRcollection* and *buildLTcollection* functions.
+ **getSegmentInfo**: Generates an array of information about segments from the breakpoint vertices identified by LandTrendr.
+ **getFittedData**: Generates an annual band stack for given index provided as *ftvList* indices to either *buildLTcollection* or *runLT*. Flattens the FTV array format to bands per given index.

### buildSRcollection

`buildSRcollection(startYear, endYear, startDay, endDay, aoi)`

+ **startYear (Integer)**: The minimum year in the desired range of annual collection
+ **endYear (Integer)**: The maximum year in the desired range of annual collection
+ **startDay (String | month day formatted as 'mm-dd')**: The minimum date in the desired seasonal range over which to generate annual composite.
+ **endDay (String | month day formatted as 'mm-dd')**: The maximum date in the desired seasonal range over which to generate annual composite.
+ **aoi (Geometry)**: The area-of-interest over which to mosaic images

Example:
```
var ltgee = require('users/emaprlab/public:Modules/LandTrendr.js');

var startYear = 1985;
var endYear = 2017;
var startDay = '06-20';
var endDay = '09-20';
var aoi = ee.Geometry.Point(-122.8848, 43.7929);

Map.centerObject(aoi,10);
Map.addLayer(aoi);

var annualSRcollection = ltgee.buildSRcollection(startYear, endYear, startDay, endDay, aoi);
print(annualSRcollection);
```

### buildLTcollection

`buildLTcollection(collection, index, ftvList)`

+ **collection (Image Collection)**: An annual surface reflectance collection generated by the `buildSRcollection` function. 
+ **index (String)**: The index from the list in the [Spectral index codes] section to be segmented by LandTrendr.
+ **ftvList (List of strings)**: A list of one or more indices from the list in the [Spectral index codes] section to be fitted to the segmentation of the `index` parameter.

Example:
```
var ltgee = require('users/emaprlab/public:Modules/LandTrendr.js');

var startYear = 1985;
var endYear = 2017;
var startDay = '06-20';
var endDay = '09-20';
var aoi = ee.Geometry.Point(-122.8848, 43.7929);
var index = 'NBR';
var ftvList = ['NDVI', 'B4', 'B3'];

Map.centerObject(aoi,10);
Map.addLayer(aoi);
var annualSRcollection = ltgee.buildSRcollection(startYear, endYear, startDay, endDay, aoi);
var annualLTcollection = ltgee.buildLTcollection(annualSRcollection, index, ftvList);
```


### runLT

**usage:**

`runLT(startYear, endYear, startDay, endDay, aoi, index, ftvList, runParams)`

+ **startYear (Integer)**: The minimum year in the desired range of annual collection
+ **endYear (Integer)**: The maximum year in the desired range of annual collection
+ **startDay (String | month day formatted as 'mm-dd')**: The minimum date in the desired seasonal range over which to generate annual composite.
+ **endDay (String | month day formatted as 'mm-dd')**: The maximum date in the desired seasonal range over which to generate annual composite.
+ **aoi (Geometry)**: The area-of-interest over which to mosaic images
+ **index (String)**: The index from the list in the [Spectral index codes] section to be segmented by LandTrendr.
+ **ftvList (List of strings)**: A list of one or more indices from the list in the [Spectral index codes] section to be fitted to the segmentation of the `index` parameter.
+ **runParams (Dictionary)**: A dictionary of parameters to control LandTrendr segmentation. You can find definitions for the dictionary keys and values in [LT parameters](./lt-gee-requirements.html#lt-parameters) section 


**Result**:
An array image described in the [LT-GEE Outputs](./lt-gee-outputs.html) section


**Example**:
```
var startYear = 1985;
var endYear = 2017;
var startDay = '06-20';
var endDay = '09-20';
var aoi = ee.Geometry.Point(-122.8848, 43.7929);
var index = 'NBR';
var ftvList = [];
var run_params = { 
  maxSegments:            6,
  spikeThreshold:         0.9,
  vertexCountOvershoot:   3,
  preventOneYearRecovery: true,
  recoveryThreshold:      0.25,
  pvalThreshold:          0.05,
  bestModelProportion:    0.75,
  minObservationsNeeded:  6
};

var lt = ltgee.runLT(startYear, endYear, startDay, endDay, aoi, index, [], runParams);
```





### getSegmentInfo

**usage:**

`getSegmentInfo(lt, index)`

+ **lt (Image Array)**: The image array that is the result of running LandTrendr (either `runLT()` or `ee.Algorithms.TemporalSegmentation.LandTrendr()`). 
+ **index (String)**: The index from the list in the [Spectral index codes] section to be segmented by LandTrendr.

**Result**:

**Example**:
```
var startYear = 1985;
var endYear = 2017;
var startDay = '06-20';
var endDay = '09-20';
var aoi = ee.Geometry.Point(-122.8848, 43.7929);
var index = 'NBR';
var ftvList = [];
var run_params = { 
  maxSegments:            6,
  spikeThreshold:         0.9,
  vertexCountOvershoot:   3,
  preventOneYearRecovery: true,
  recoveryThreshold:      0.25,
  pvalThreshold:          0.05,
  bestModelProportion:    0.75,
  minObservationsNeeded:  6
};

var lt = ltgee.runLT(startYear, endYear, startDay, endDay, aoi, index, [], runParams);
var segInfo = ltgee.getSegmentInfo(lt, index)

```

### getFittedData

**usage:**

**Result**:

**Example**:


## Spectral index codes 

The LandTrendr.js functions library has a defined list of indices and bands that it will work with. Below in Table 9.1 is the list of 'index' codes to use and their common name. You should specify them as an all caps string.


```{r echo=F}
Code = c('NBR', 'NDVI', 'NDSI', 'TCB', 'TCG', 'TCW', 'TCA', 'B1', 'B2', 'B3', 'B4', 'B5', 'B7')
Name = c('Normalized Burn Ratio', 'Normalized Difference Vegetation Index', 'Normalized Different Snow Index',
         'Tasseled-Cap Brightness', 'Tasseled-Cap Greenness', 'Tasseled-Cap Wetness', 'Tasseled-Cap Angle',
         'Thematic Mapper-equivalent Band 1','Thematic Mapper-equivalent Band 2','Thematic Mapper-equivalent Band 3','Thematic Mapper-equivalent Band 4',
         'Thematic Mapper-equivalent Band 5','Thematic Mapper-equivalent Band 7')

```




```{r echo=F, index-codes, tidy=FALSE}
knitr::kable(
  data.frame(Code, Name), 
  caption = 'Spectral Index Codes',
  booktabs = TRUE
)
```





